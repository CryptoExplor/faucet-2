<!DOCTYPE html>
<html lang="en">
<head>
Â  <meta charset="UTF-8" />
Â  <meta name="viewport" content="width=390, initial-scale=1.0" />
Â  <title>SuperChain Faucet</title>

Â  <!-- Tailwind CSS -->
Â  <script src="https://cdn.tailwindcss.com"></script>
Â  <style>
Â  Â  /* Custom styles for the app */
Â  Â  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
Â  Â  body {
Â  Â  Â  font-family: 'Inter', sans-serif;
Â  Â  }
Â  Â  .select-network {
Â  Â  Â  background-color: #333;
Â  Â  Â  border: 1px solid #444;
Â  Â  Â  color: white;
Â  Â  Â  padding: 0.5rem;
Â  Â  Â  border-radius: 8px;
Â  Â  }
Â  Â  .spinner {
Â  Â  Â  border: 2px solid rgba(255, 255, 255, 0.2);
Â  Â  Â  border-top: 2px solid #fff;
Â  Â  Â  border-radius: 50%;
Â  Â  Â  width: 16px;
Â  Â  Â  height: 16px;
Â  Â  Â  animation: spin 1s linear infinite;
Â  Â  }
Â  Â  @keyframes spin {
Â  Â  Â  0% { transform: rotate(0deg); }
Â  Â  Â  100% { transform: rotate(360deg); }
Â  Â  }
Â  </style>

Â  <!-- Farcaster Mini App Metadata from user-provided frame.html -->
Â  <meta property="fc:miniapp" content='{
Â  Â  "version": "1",
Â  Â  "imageUrl": "https://faucet-2.vercel.app/frame-image.jpg",
Â  Â  "button": {
Â  Â  Â  "title": "ðŸš° Claim Test ETH (Unofficial)",
Â  Â  Â  "action": {
Â  Â  Â  Â  "type": "launch_frame",
Â  Â  Â  Â  "name": "SuperChain Faucet",
Â  Â  Â  Â  "url": "https://faucet-2.vercel.app/",
Â  Â  Â  Â  "splashImageUrl": "/public/frame-image.svg",
Â  Â  Â  Â  "splashBackgroundColor": "#f8fafc"
Â  Â  Â  }
Â  Â  }
Â  }' />

Â  <meta name="description" content="Unofficial faucet for SuperChain testnets. Claim test ETH with Gitcoin Passport verification.">
Â  <meta property="og:title" content="SuperChain Faucet (Unofficial)">
Â  <meta property="og:description" content="Unofficial faucet for SuperChain development. Get test ETH with Gitcoin Passport score â‰¥ 10.">
Â  <meta property="og:image" content="/public/frame-image.svg">
Â  <meta property="og:url" content="/index.html">
Â  <meta name="twitter:card" content="summary_large_image">
</head>
<body class="bg-[#111] text-white flex flex-col items-center min-h-screen p-4">

Â  <!-- App Header Card -->
Â  <div class="bg-[#222] p-8 rounded-xl text-center w-full max-w-sm mb-5">
Â  Â  <h1 class="text-2xl font-bold">SuperChain Faucet</h1>
Â  Â  <p class="mt-2 text-gray-400">Claim test ETH on a variety of Superchain networks!</p>
Â  </div>
Â  
Â  <!-- Network Selection -->
Â  <div class="bg-[#222] p-6 rounded-xl w-full max-w-sm mb-5 text-center">
Â  Â  <h2 class="text-xl font-semibold mb-3">Select Network</h2>
Â  Â  <select id="networkSelector" class="select-network w-full">
Â  Â  Â  <!-- Options will be populated by JavaScript -->
Â  Â  </select>
Â  </div>
Â  
Â  <!-- Claim Requirements Card -->
Â  <div class="bg-[#222] p-6 rounded-xl w-full max-w-sm mb-5">
Â  Â  <h2 class="text-xl font-semibold mb-3">Claim Requirements</h2>
Â  Â  
Â  Â  <!-- Wallet Connected Status -->
Â  Â  <div class="flex items-center justify-between py-2 border-b border-gray-700">
Â  Â  Â  <span class="flex items-center gap-2">
Â  Â  Â  Â  Wallet Connected
Â  Â  Â  </span>
Â  Â  Â  <div id="walletStatus">
Â  Â  Â  Â  <!-- Status and icon will be rendered here by JavaScript -->
Â  Â  Â  </div>
Â  Â  </div>
Â  Â  
Â  Â  <!-- Gitcoin Passport Status -->
Â  Â  <div class="flex items-center justify-between py-2 border-b border-gray-700">
Â  Â  Â  <span class="flex items-center gap-2">
Â  Â  Â  Â  Gitcoin Passport Score
Â  Â  Â  </span>
Â  Â  Â  <div id="passportStatus">
Â  Â  Â  Â  <!-- Score will be rendered here by JavaScript -->
Â  Â  Â  </div>
Â  Â  </div>
Â  Â  
Â  Â  <!-- Rate Limit Status -->
Â  Â  <div class="flex items-center justify-between py-2">
Â  Â  Â  <span class="flex items-center gap-2">
Â  Â  Â  Â  Rate Limit
Â  Â  Â  </span>
Â  Â  Â  <div id="rateLimitStatus">
Â  Â  Â  Â  <!-- Status will be rendered here by JavaScript -->
Â  Â  Â  </div>
Â  Â  </div>
Â  </div>
Â  
Â  <!-- Last Claim History Card -->
Â  <div class="bg-[#222] p-6 rounded-xl w-full max-w-sm mb-5">
Â  Â  Â  <h2 class="text-xl font-semibold mb-3">Last Claim</h2>
Â  Â  Â  <div id="lastClaimDetails" class="text-sm text-gray-400">
Â  Â  Â  Â  Â  No previous claims found.
Â  Â  Â  </div>
Â  </div>

Â  <!-- Claim Button -->
Â  <button id="claimButton" class="px-8 py-4 text-xl font-bold rounded-lg mb-3 bg-white text-black transition-transform transform hover:scale-105">
Â  Â  CLAIM ETH
Â  </button>

Â  <!-- Status Message Box -->
Â  <div id="statusBox" class="px-3 py-2 rounded-lg text-sm w-full max-w-sm text-center"></div>
Â  
Â  <script type="module">
Â  Â  import {
Â  Â  Â  createConfig,
Â  Â  Â  connect,
Â  Â  Â  http
Â  Â  } from 'https://esm.sh/@wagmi/core@2.11.7';
Â  Â  import { farcasterMiniApp } from 'https://esm.sh/@farcaster/miniapp-wagmi-connector';
Â  Â  import { sdk } from 'https://esm.sh/@farcaster/miniapp-sdk';
Â  Â  
Â  Â  // Import Lucide icons as SVG strings for direct insertion
Â  Â  const checkIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-check-circle-2 text-green-500"><path d="M12 2a10 10 0 1 0 10 10A10 10 0 0 0 12 2Z"/><path d="m9 12 2 2 4-4"/></svg>`;
Â  Â  const crossIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x-circle text-red-500"><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></svg>`;
Â  Â  const clockIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clock"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>`;
Â  Â  const spinner = `<div class="spinner"></div>`;
Â  Â  const warningIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-alert-circle text-yellow-500"><circle cx="12" cy="12" r="10"/><path d="M12 8v4"/><path d="M12 16h.01"/></svg>`;

Â  Â  // --- State Variables ---
Â  Â  let account = null;
Â  Â  let isConnected = false;
Â  Â  let passportData = null;
Â  Â  let rateLimitData = null;
Â  Â  let isClaiming = false;
Â  Â  let isRequirementsLoading = false;
Â  Â  let selectedNetwork = null;
Â  Â  let wagmiConfig = null;
Â  Â  let lastClaimData = null;
Â  Â  let isFarcasterEnv = false;

Â  Â  // --- Configuration for Deployment ---
Â  Â  // !!! IMPORTANT: Replace these with your actual values before deploying !!!
Â  Â  const PASSPORT_THRESHOLD = 10;
Â  Â  const RATE_LIMIT_HOURS = 24;
Â  Â  const UPSTASH_REST_URL = 'https://[YOUR_REDIS_URL].upstash.io';
Â  Â  const UPSTASH_REST_TOKEN = '[YOUR_REDIS_TOKEN]';
Â  Â  // These would be your serverless function endpoints
Â  Â  const PASSPORT_API_URL = '/api/passport-score'; 
Â  Â  const CLAIM_API_URL = '/api/claim-eth';

Â  Â  // --- Network Data (Updated with id) ---
Â  Â  const SUPPORTED_NETWORKS = [
Â  Â  Â  { id: "base-sepolia", name: "Base Sepolia", chainId: 84532, rpcUrl: "https://sepolia.base.org", nativeCurrency: "ETH", explorerUrl: "https://sepolia.basescan.org", faucetAmount: "0.001", isActive: true },
Â  Â  Â  { id: "optimism-sepolia", name: "Optimism Sepolia", chainId: 11155420, rpcUrl: "https://sepolia.optimism.io", nativeCurrency: "ETH", explorerUrl: "https://sepolia-optimism.etherscan.io", faucetAmount: "0.001", isActive: true },
Â  Â  Â  { id: "arbitrum-sepolia", name: "Arbitrum Sepolia", chainId: 421614, rpcUrl: "https://sepolia-rollup.arbitrum.io/rpc", nativeCurrency: "ETH", explorerUrl: "https://sepolia.arbiscan.io", faucetAmount: "0.001", isActive: true },
Â  Â  Â  { id: "ink-sepolia", name: "Ink Sepolia", chainId: 763373, rpcUrl: "https://rpc-gel-sepolia.inkonchain.com", nativeCurrency: "ETH", explorerUrl: "https://explorer-sepolia.inkonchain.com", faucetAmount: "0.001", isActive: true },
Â  Â  Â  { id: "mode-sepolia", name: "Mode Sepolia", chainId: 919, rpcUrl: "https://sepolia.mode.network", nativeCurrency: "ETH", explorerUrl: "https://sepolia.explorer.mode.network", faucetAmount: "0.001", isActive: true },
Â  Â  Â  { id: "zora-sepolia", name: "Zora Sepolia", chainId: 999999999, rpcUrl: "https://sepolia.rpc.zora.energy", nativeCurrency: "ETH", explorerUrl: "https://sepolia.explorer.zora.energy", faucetAmount: "0.001", isActive: true },
Â  Â  Â  { id: "unichain-sepolia", name: "Unichain Sepolia", chainId: 1301, rpcUrl: "https://sepolia.unichain.org", nativeCurrency: "ETH", explorerUrl: "https://sepolia.uniscan.xyz", faucetAmount: "0.001", isActive: true },
Â  Â  Â  { id: "blast-sepolia", name: "Blast Sepolia", chainId: 168587773, rpcUrl: "https://sepolia.blast.io", nativeCurrency: "ETH", explorerUrl: "https://testnet.blastscan.io", faucetAmount: "0.001", isActive: true },
Â  Â  Â  { id: "frax-sepolia", name: "Frax Sepolia", chainId: 2522, rpcUrl: "https://rpc.testnet.frax.com", nativeCurrency: "frxETH", explorerUrl: "https://holesky.fraxscan.com", faucetAmount: "0.001", isActive: true },
Â  Â  Â  { id: "cyber-sepolia", name: "Cyber Sepolia", chainId: 111557560, rpcUrl: "https://cyber-testnet.alt.technology", nativeCurrency: "ETH", explorerUrl: "https://testnet.cyberscan.co", faucetAmount: "0.001", isActive: true },
Â  Â  ];
Â  Â  
Â  Â  // Get all active networks
Â  Â  const getActiveNetworks = () => SUPPORTED_NETWORKS.filter(n => n.isActive);
Â  Â  // Get network by chain ID
Â  Â  const getNetworkByChainId = (chainId) => SUPPORTED_NETWORKS.find(n => n.chainId === chainId) || null;
Â  Â  // Get network by ID
Â  Â  const getNetworkById = (id) => SUPPORTED_NETWORKS.find(n => n.id === id) || null;

Â  Â  // --- DOM Elements ---
Â  Â  const networkSelector = document.getElementById('networkSelector');
Â  Â  const walletStatus = document.getElementById('walletStatus');
Â  Â  const passportStatus = document.getElementById('passportStatus');
Â  Â  const rateLimitStatus = document.getElementById('rateLimitStatus');
Â  Â  const claimButton = document.getElementById('claimButton');
Â  Â  const statusBox = document.getElementById('statusBox');
Â  Â  const lastClaimDetails = document.getElementById('lastClaimDetails');

Â  Â  // --- Utility Functions ---

Â  Â  // Function to set the status message in the UI
Â  Â  const setStatus = (msg, type = '') => {
Â  Â  Â  statusBox.innerHTML = msg;
Â  Â  Â  statusBox.className = `px-3 py-2 rounded-lg text-sm w-full max-w-sm text-center ${
Â  Â  Â  Â  type === 'success' ? 'bg-blue-700' :
Â  Â  Â  Â  type === 'error' ? 'bg-red-700' : 'bg-yellow-700'
Â  Â  Â  }`;
Â  Â  };
Â  Â  
Â  Â  // Function to format the remaining time for the UI
Â  Â  const formatTimeRemaining = (ms) => {
Â  Â  Â  if (ms <= 0) return '0 minutes';
Â  Â  Â  const seconds = Math.floor(ms / 1000);
Â  Â  Â  const minutes = Math.floor(seconds / 60);
Â  Â  Â  const hours = Math.floor(minutes / 60);
Â  Â  Â  const days = Math.floor(hours / 24);

Â  Â  Â  let result = [];
Â  Â  Â  if (days > 0) result.push(`${days} days`);
Â  Â  Â  if (hours > 0) result.push(`${hours % 24} hours`);
Â  Â  Â  if (minutes > 0) result.push(`${minutes % 60} minutes`);
Â  Â  Â  if (result.length === 0) result.push('less than a minute');

Â  Â  Â  return result.join(', ');
Â  Â  };

Â  Â  // --- Upstash/Server-side API Interaction Functions ---

Â  Â  // Function to simulate a fetch call to a serverless function for passport data
Â  Â  const fetchPassportData = async (address) => {
Â  Â  Â  // In a real app, this would be a fetch call to your serverless function
Â  Â  Â  // that interacts with the Gitcoin Passport API.
Â  Â  Â  // Example: `const response = await fetch(`${PASSPORT_API_URL}?address=${address}`);`
Â  Â  Â  // For this example, we'll simulate the response.
Â  Â  Â  return new Promise((resolve, reject) => {
Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  const score = Math.random() * 20; // Simulating a score
Â  Â  Â  Â  Â  const data = {
Â  Â  Â  Â  Â  Â  score: score,
Â  Â  Â  Â  Â  Â  address: address,
Â  Â  Â  Â  Â  Â  passing_score: score >= PASSPORT_THRESHOLD,
Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  resolve(data);
Â  Â  Â  Â  }, 1000);
Â  Â  Â  });
Â  Â  };
Â  Â  
Â  Â  // Function to load last claim data from Upstash
Â  Â  const loadLastClaimData = async () => {
Â  Â  Â  Â  // This function would fetch the claim data from your Upstash instance.
Â  Â  Â  Â  // The key would be something like 'faucet:claim:{account}:{networkId}'
Â  Â  Â  Â  // Example: `const response = await fetch(UPSTASH_REST_URL, {
Â  Â  Â  Â  // Â  method: 'POST',
Â  Â  Â  Â  // Â  headers: { 'Authorization': `Bearer ${UPSTASH_REST_TOKEN}` },
Â  Â  Â  Â  // Â  body: JSON.stringify(['GET', `faucet:claim:${account}:${selectedNetwork.id}`])
Â  Â  Â  Â  // });`
Â  Â  Â  Â  return new Promise((resolve) => {
Â  Â  Â  Â  Â  Â  const storedClaims = JSON.parse(localStorage.getItem('faucetClaims') || '{}');
Â  Â  Â  Â  Â  Â  resolve(storedClaims[account]?.[selectedNetwork.id] || null);
Â  Â  Â  Â  });
Â  Â  };
Â  Â  
Â  Â  // Function to save last claim data to Upstash
Â  Â  const saveLastClaimData = async (claim) => {
Â  Â  Â  Â  // This function would save the claim data to your Upstash instance.
Â  Â  Â  Â  // It should use the `SET` command with an expiration time.
Â  Â  Â  Â  // Example: `const expires = RATE_LIMIT_HOURS * 60 * 60;`
Â  Â  Â  Â  // `const response = await fetch(UPSTASH_REST_URL, {
Â  Â  Â  Â  // Â  method: 'POST',
Â  Â  Â  Â  // Â  headers: { 'Authorization': `Bearer ${UPSTASH_REST_TOKEN}` },
Â  Â  Â  Â  // Â  body: JSON.stringify(['SET', `faucet:claim:${account}:${selectedNetwork.id}`, JSON.stringify(claim), 'EX', expires])
Â  Â  Â  Â  // });`
Â  Â  Â  Â  return new Promise((resolve) => {
Â  Â  Â  Â  Â  Â  const storedClaims = JSON.parse(localStorage.getItem('faucetClaims') || '{}');
Â  Â  Â  Â  Â  Â  if (!storedClaims[account]) {
Â  Â  Â  Â  Â  Â  Â  Â  storedClaims[account] = {};
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  storedClaims[account][selectedNetwork.id] = claim;
Â  Â  Â  Â  Â  Â  localStorage.setItem('faucetClaims', JSON.stringify(storedClaims));
Â  Â  Â  Â  Â  Â  resolve();
Â  Â  Â  Â  });
Â  Â  };


Â  Â  // --- UI Update Function ---
Â  Â  const updateUI = () => {
Â  Â  Â  if (!isFarcasterEnv) {
Â  Â  Â  Â  walletStatus.innerHTML = `Not in Farcaster ${warningIcon}`;
Â  Â  Â  Â  passportStatus.innerHTML = `Not in Farcaster ${warningIcon}`;
Â  Â  Â  Â  rateLimitStatus.innerHTML = `Not in Farcaster ${warningIcon}`;
Â  Â  Â  Â  claimButton.innerText = 'Launch in Farcaster';
Â  Â  Â  Â  claimButton.disabled = true;
Â  Â  Â  Â  claimButton.className = 'px-8 py-4 text-xl font-bold rounded-lg mb-3 bg-gray-600 text-gray-400 cursor-not-allowed';
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  walletStatus.innerHTML = isConnected ? `<span class="font-mono text-xs">${account.slice(0, 6)}...${account.slice(-4)}</span> ${checkIcon}` : crossIcon;

Â  Â  Â  if (isRequirementsLoading) {
Â  Â  Â  Â  passportStatus.innerHTML = spinner;
Â  Â  Â  Â  rateLimitStatus.innerHTML = spinner;
Â  Â  Â  } else {
Â  Â  Â  Â  // Passport Status
Â  Â  Â  Â  if (passportData) {
Â  Â  Â  Â  Â  if (passportData.passing_score) {
Â  Â  Â  Â  Â  Â  passportStatus.innerHTML = `<span class="text-green-500 font-semibold">${passportData.score.toFixed(2)} (Passed)</span>`;
Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  passportStatus.innerHTML = `<span class="text-red-500 font-semibold">${passportData.score.toFixed(2)} (Failed)</span>`;
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â passportStatus.innerHTML = `<span class="text-red-500 font-semibold">N/A (Failed)</span>`;
Â  Â  Â  Â  }

Â  Â  Â  Â  // Rate Limit Status
Â  Â  Â  Â  if (rateLimitData?.isRateLimited) {
Â  Â  Â  Â  Â  rateLimitStatus.innerHTML = `<span class="flex items-center gap-1 text-red-500 font-semibold">${clockIcon} ${formatTimeRemaining(rateLimitData.remainingTime)}</span>`;
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  rateLimitStatus.innerHTML = `<span class="text-green-500 font-semibold">Available</span>`;
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  Â  
Â  Â  Â  const isButtonDisabled = 
Â  Â  Â  Â  !isConnected || 
Â  Â  Â  Â  isClaiming || 
Â  Â  Â  Â  isRequirementsLoading ||
Â  Â  Â  Â  (passportData && !passportData.passing_score) ||
Â  Â  Â  Â  (rateLimitData && rateLimitData.isRateLimited);

Â  Â  Â  claimButton.disabled = isButtonDisabled;
Â  Â  Â  if (isButtonDisabled) {
Â  Â  Â  Â  claimButton.className = 'px-8 py-4 text-xl font-bold rounded-lg mb-3 bg-gray-600 text-gray-400 cursor-not-allowed';
Â  Â  Â  } else {
Â  Â  Â  Â  claimButton.className = 'px-8 py-4 text-xl font-bold rounded-lg mb-3 bg-white text-black transition-transform transform hover:scale-105';
Â  Â  Â  }
Â  Â  Â  
Â  Â  Â  // Update button text based on state
Â  Â  Â  if (isClaiming) {
Â  Â  Â  Â  claimButton.innerText = 'Claimingâ€¦';
Â  Â  Â  } else if (!isConnected) {
Â  Â  Â  Â  claimButton.innerText = 'CONNECT WALLET';
Â  Â  Â  } else if (isRequirementsLoading) {
Â  Â  Â  Â  claimButton.innerText = 'Checking Requirementsâ€¦';
Â  Â  Â  } else if (passportData && !passportData.passing_score) {
Â  Â  Â  Â  claimButton.innerText = `Need score â‰¥ ${PASSPORT_THRESHOLD}`;
Â  Â  Â  } else if (rateLimitData && rateLimitData.isRateLimited) {
Â  Â  Â  Â  claimButton.innerText = `Try again in ${formatTimeRemaining(rateLimitData.remainingTime)}`;
Â  Â  Â  } else {
Â  Â  Â  Â  claimButton.innerText = `CLAIM ETH`;
Â  Â  Â  }
Â  Â  Â  
Â  Â  Â  // Last Claim Display
Â  Â  Â  if (lastClaimData) {
Â  Â  Â  Â  Â  const claimedAt = new Date(lastClaimData.claimedAt);
Â  Â  Â  Â  Â  lastClaimDetails.innerHTML = `
Â  Â  Â  Â  Â  Â  <p>Amount: ${lastClaimData.amount} ${getNetworkById(lastClaimData.networkId)?.nativeCurrency}</p>
Â  Â  Â  Â  Â  Â  <p>Timestamp: ${claimedAt.toLocaleString()}</p>
Â  Â  Â  Â  Â  Â  <p>Tx Hash: <a href="${getNetworkById(lastClaimData.networkId)?.explorerUrl}/tx/${lastClaimData.txHash}" target="_blank" class="underline">${lastClaimData.txHash.slice(0, 10)}...${lastClaimData.txHash.slice(-8)}</a></p>
Â  Â  Â  Â  Â  `;
Â  Â  Â  } else {
Â  Â  Â  Â  Â  lastClaimDetails.textContent = "No previous claims found.";
Â  Â  Â  }
Â  Â  };

Â  Â  // --- Main App Logic ---
Â  Â  const updateWagmiConfig = (network) => {
Â  Â  Â  Â  // Find the chain object in wagmi's supported chains
Â  Â  Â  Â  const chain = { 
Â  Â  Â  Â  Â  id: network.chainId,
Â  Â  Â  Â  Â  name: network.name,
Â  Â  Â  Â  Â  nativeCurrency: { name: network.nativeCurrency, symbol: network.nativeCurrency, decimals: 18 },
Â  Â  Â  Â  Â  rpcUrls: { default: { http: [network.rpcUrl] } },
Â  Â  Â  Â  Â  blockExplorers: { default: { name: 'Explorer', url: network.explorerUrl } },
Â  Â  Â  Â  Â  testnet: true
Â  Â  Â  Â  };

Â  Â  Â  Â  wagmiConfig = createConfig({
Â  Â  Â  Â  Â  Â  chains: [chain],
Â  Â  Â  Â  Â  Â  transports: { [network.chainId]: http() }
Â  Â  Â  Â  });
Â  Â  Â  Â  console.log("Wagmi config updated for:", network.name);
Â  Â  };

Â  Â  // Fetches passport and rate limit data
Â  Â  const fetchRequirements = async () => {
Â  Â  Â  Â  if (!isConnected) return;
Â  Â  Â  Â  
Â  Â  Â  Â  isRequirementsLoading = true;
Â  Â  Â  Â  setStatus('Checking requirements...', 'info');
Â  Â  Â  Â  updateUI();

Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  // Fetch passport data from your serverless function
Â  Â  Â  Â  Â  Â  passportData = await fetchPassportData(account);
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // Check rate limit from your Upstash instance
Â  Â  Â  Â  Â  Â  const lastClaim = await loadLastClaimData();
Â  Â  Â  Â  Â  Â  const now = new Date();
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  if (lastClaim) {
Â  Â  Â  Â  Â  Â  Â  Â  const claimedAt = new Date(lastClaim.claimedAt).getTime();
Â  Â  Â  Â  Â  Â  Â  Â  const nextClaimTime = claimedAt + RATE_LIMIT_HOURS * 60 * 60 * 1000;
Â  Â  Â  Â  Â  Â  Â  Â  const remainingTime = nextClaimTime - now.getTime();
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  if (remainingTime > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  rateLimitData = {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isRateLimited: true,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  nextClaimTime: nextClaimTime,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  remainingTime: remainingTime
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  rateLimitData = {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isRateLimited: false,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  nextClaimTime: null,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  remainingTime: 0
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  rateLimitData = {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isRateLimited: false,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  nextClaimTime: null,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  remainingTime: 0
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  setStatus('Requirements checked. Ready to claim.', 'success');
Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  console.error('Failed to check faucet requirements', e);
Â  Â  Â  Â  Â  Â  setStatus('Failed to check faucet requirements. Please try again.', 'error');
Â  Â  Â  Â  } finally {
Â  Â  Â  Â  Â  Â  isRequirementsLoading = false;
Â  Â  Â  Â  Â  Â  updateUI();
Â  Â  Â  Â  }
Â  Â  };
Â  Â  
Â  Â  // Handle faucet claim transaction
Â  Â  const handleClaim = async () => {
Â  Â  Â  isClaiming = true;
Â  Â  Â  setStatus(`Claiming ${selectedNetwork.nativeCurrency} on ${selectedNetwork.name}...`, 'info');
Â  Â  Â  updateUI();
Â  Â  Â  
Â  Â  Â  try {
Â  Â  Â  Â  // Call your serverless function to perform the faucet claim
Â  Â  Â  Â  const response = await fetch(CLAIM_API_URL, {
Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  headers: { 'Content-Type': 'application/json' },
Â  Â  Â  Â  Â  Â  body: JSON.stringify({
Â  Â  Â  Â  Â  Â  Â  Â  address: account,
Â  Â  Â  Â  Â  Â  Â  Â  networkId: selectedNetwork.id,
Â  Â  Â  Â  Â  Â  Â  Â  amount: selectedNetwork.faucetAmount,
Â  Â  Â  Â  Â  Â  }),
Â  Â  Â  Â  });

Â  Â  Â  Â  if (!response.ok) {
Â  Â  Â  Â  Â  Â  const error = await response.json();
Â  Â  Â  Â  Â  Â  throw new Error(error.message || 'Server-side claim failed.');
Â  Â  Â  Â  }

Â  Â  Â  Â  const result = await response.json();
Â  Â  Â  Â  const hash = result.txHash;

Â  Â  Â  Â  const claimedAt = new Date().toISOString();
Â  Â  Â  Â  const newClaim = {
Â  Â  Â  Â  Â  Â  walletAddress: account,
Â  Â  Â  Â  Â  Â  networkId: selectedNetwork.id,
Â  Â  Â  Â  Â  Â  amount: selectedNetwork.faucetAmount,
Â  Â  Â  Â  Â  Â  txHash: hash,
Â  Â  Â  Â  Â  Â  claimedAt: claimedAt,
Â  Â  Â  Â  Â  Â  passportScore: passportData.score.toFixed(2),
Â  Â  Â  Â  Â  Â  isSuccessful: true
Â  Â  Â  Â  };
Â  Â  Â  Â  
Â  Â  Â  Â  // Save the claim to your Upstash instance
Â  Â  Â  Â  await saveLastClaimData(newClaim);
Â  Â  Â  Â  
Â  Â  Â  Â  setStatus(
Â  Â  Â  Â  Â  `âœ… Claim Successful <a href="${selectedNetwork.explorerUrl}/tx/${hash}" target="_blank" class="underline">View Tx</a>`,
Â  Â  Â  Â  Â  'success'
Â  Â  Â  Â  );
Â  Â  Â  Â  
Â  Â  Â  Â  await fetchRequirements();
Â  Â  Â  Â  
Â  Â  Â  } catch (e) {
Â  Â  Â  Â  console.warn('Claim rejected or failed', e);
Â  Â  Â  Â  setStatus(`Claim rejected or failed: ${e.message}`, 'error');
Â  Â  Â  } finally {
Â  Â  Â  Â  isClaiming = false;
Â  Â  Â  Â  updateUI();
Â  Â  Â  }
Â  Â  };

Â  Â  // The main function to initialize the app
Â  Â  const init = async () => {
Â  Â  Â  Â  isFarcasterEnv = typeof sdk.actions.ready === 'function';
Â  Â  Â  Â  
Â  Â  Â  Â  if (!isFarcasterEnv) {
Â  Â  Â  Â  Â  Â  setStatus('This app must be opened inside a Farcaster Mini App client to function.', 'error');
Â  Â  Â  Â  Â  Â  updateUI();
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  // Populate the network selector dropdown
Â  Â  Â  Â  const activeNetworks = getActiveNetworks();
Â  Â  Â  Â  activeNetworks.forEach(network => {
Â  Â  Â  Â  Â  const option = document.createElement('option');
Â  Â  Â  Â  Â  option.value = network.chainId;
Â  Â  Â  Â  Â  option.textContent = network.name;
Â  Â  Â  Â  Â  networkSelector.appendChild(option);
Â  Â  Â  Â  });
Â  Â  Â  Â  
Â  Â  Â  Â  // Set the initial network
Â  Â  Â  Â  selectedNetwork = activeNetworks[0];
Â  Â  Â  Â  networkSelector.value = selectedNetwork.chainId;
Â  Â  Â  Â  updateWagmiConfig(selectedNetwork);
Â  Â  Â  Â  
Â  Â  Â  Â  // Initial connect and data fetch
Â  Â  Â  Â  await connectWallet();
Â  Â  Â  Â  
Â  Â  Â  Â  // Listen for network changes
Â  Â  Â  Â  networkSelector.addEventListener('change', async (event) => {
Â  Â  Â  Â  Â  const chainId = parseInt(event.target.value);
Â  Â  Â  Â  Â  selectedNetwork = getNetworkByChainId(chainId);
Â  Â  Â  Â  Â  updateWagmiConfig(selectedNetwork);
Â  Â  Â  Â  Â  await fetchRequirements();
Â  Â  Â  Â  });
Â  Â  Â  Â  
Â  Â  Â  Â  // Event listener for the claim button
Â  Â  Â  Â  claimButton.addEventListener('click', handleClaim);
Â  Â  Â  Â  
Â  Â  Â  Â  // Set up an interval to update the rate limit countdown
Â  Â  Â  Â  setInterval(() => {
Â  Â  Â  Â  Â  if (rateLimitData?.isRateLimited) {
Â  Â  Â  Â  Â  Â  rateLimitData.remainingTime = rateLimitData.nextClaimTime - Date.now();
Â  Â  Â  Â  Â  Â  if (rateLimitData.remainingTime <= 0) {
Â  Â  Â  Â  Â  Â  Â  fetchRequirements(); // Re-fetch data to clear rate limit
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  updateUI();
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }, 1000);
Â  Â  };

Â  Â  const connectWallet = async () => {
Â  Â  Â  Â  setStatus('Connecting wallet...');
Â  Â  Â  Â  updateUI();
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  const { accounts } = await connect(wagmiConfig, { connector: farcasterMiniApp() });
Â  Â  Â  Â  Â  account = accounts[0];
Â  Â  Â  Â  Â  isConnected = true;
Â  Â  Â  Â  Â  await fetchRequirements();
Â  Â  Â  Â  Â  setStatus('Wallet connected!', 'success');
Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  console.error('Farcaster connect failed', e);
Â  Â  Â  Â  Â  setStatus('Failed to connect wallet.', 'error');
Â  Â  Â  Â  Â  isConnected = false;
Â  Â  Â  Â  }
Â  Â  Â  Â  updateUI();
Â  Â  };

Â  Â  document.addEventListener('DOMContentLoaded', init);
Â  </script>
</body>
</html>
